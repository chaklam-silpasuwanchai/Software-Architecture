(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{444:function(e,r,t){"use strict";t.r(r);var a=t(54),s=Object(a.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"docker-swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm"}},[e._v("#")]),e._v(" Docker Swarm")]),e._v(" "),t("h2",{attrs:{id:"what-is-orchestration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#what-is-orchestration"}},[e._v("#")]),e._v(" What is Orchestration?")]),e._v(" "),t("ul",[t("li",[e._v("To make it short, it means how we can manage our containers on multiple hosts.")]),e._v(" "),t("li",[e._v("(2022) There are two popular Orchestration software.\n"),t("ul",[t("li",[t("a",{attrs:{href:"https://kubernetes.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kubernetes/Kube/K8s"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Swarm Mode"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("and more...\n"),t("ul",[t("li",[t("a",{attrs:{href:"https://k3s.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("K3s"),t("OutboundLink")],1),e._v(" (Lightweight Kubernetes)")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.openstack.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("openstack"),t("OutboundLink")],1),e._v(" (supports VM cluster, Containe Orchestration or K8s)")])])])])])]),e._v(" "),t("h3",{attrs:{id:"main-feature-hightlights"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#main-feature-hightlights"}},[e._v("#")]),e._v(" Main Feature Hightlights")]),e._v(" "),t("ul",[t("li",[e._v("Cluster management")]),e._v(" "),t("li",[e._v("Scaling")]),e._v(" "),t("li",[e._v("Secure by default")]),e._v(" "),t("li",[e._v("Rolling updates")])]),e._v(" "),t("p",[t("a",{attrs:{href:"https://docs.docker.com/engine/swarm/#feature-highlights",target:"_blank",rel:"noopener noreferrer"}},[e._v("ref"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"understanding-workflow-of-orchestration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#understanding-workflow-of-orchestration"}},[e._v("#")]),e._v(" Understanding Workflow of Orchestration")]),e._v(" "),t("ol",[t("li",[e._v("There is no build "),t("strong",[e._v("Docker Image")]),e._v(" concept in Orchestration.")]),e._v(" "),t("li",[e._v("Therefore, we need "),t("strong",[e._v("Docker Registry")]),e._v(" for storing the Images because all node in cluster needs to pull from Docker Registry.\n"),t("ul",[t("li",[e._v("There are many ways to store you Image(s).\n"),t("ul",[t("li",[t("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Hub"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub Container Registry"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://cloud.google.com/container-registry",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google Cloud Container Registry (GCR)"),t("OutboundLink")],1),e._v(" (If you want to use K8s (Kubernetes), you might need GCP)")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://hub.docker.com/_/registry",target:"_blank",rel:"noopener noreferrer"}},[e._v("create your own local Registry"),t("OutboundLink")],1),e._v(" We will use this for workshop.")]),e._v(" "),t("li",[e._v("and more ...")])])])])]),e._v(" "),t("li",[e._v("Orchestration will do their jobs (pull, run container(s), manage).")])]),e._v(" "),t("h2",{attrs:{id:"docker-tag-and-how-to-push-them-link"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-tag-and-how-to-push-them-link"}},[e._v("#")]),e._v(" Docker tag and how to push them "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/tag/",target:"_blank",rel:"noopener noreferrer"}},[e._v("link"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("{registry host}/{username}/{repositories or Image name}:{version}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"docker-hub"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-hub"}},[e._v("#")]),e._v(" Docker hub")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker build . -t raknatee/my-image:v1\ndocker push raknatee/my-image:v1\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h3",{attrs:{id:"gcr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gcr"}},[e._v("#")]),e._v(" GCR")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker build . -t gcr.io/{PROJECT-ID}/my-image:v1\ndocker push gcr.io/{PROJECT-ID}/my-image:v1\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h3",{attrs:{id:"local"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#local"}},[e._v("#")]),e._v(" Local")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker build . -t localhost:5000/raknatee/my-image:v1\ndocker push localhost:5000/raknatee/my-image:v1\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h2",{attrs:{id:"understanding-docker-swarm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#understanding-docker-swarm"}},[e._v("#")]),e._v(" Understanding Docker Swarm")]),e._v(" "),t("h3",{attrs:{id:"node-s-link"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-s-link"}},[e._v("#")]),e._v(" Node(s) "),t("a",{attrs:{href:"https://docs.docker.com/engine/swarm/key-concepts/#nodes",target:"_blank",rel:"noopener noreferrer"}},[e._v("link"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[e._v("Node is a computer machine or VM.")]),e._v(" "),t("li",[e._v("There are two types of node in Swarm.\n"),t("ul",[t("li",[e._v("Manager node(s): used for cluster management, we can have multi-manager nodes but only one will be "),t("strong",[e._v("Leader of Manager node")]),e._v(".")]),e._v(" "),t("li",[e._v("Worker node(s): used for running container(s)")])])])]),e._v(" "),t("h3",{attrs:{id:"overlay-networks-link"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overlay-networks-link"}},[e._v("#")]),e._v(" Overlay Networks "),t("a",{attrs:{href:"https://docs.docker.com/network/overlay/",target:"_blank",rel:"noopener noreferrer"}},[e._v("link"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[e._v("To make it short, it looks like merge every IP address into one cluster. Therefore, you can access the cluster by using any IP address of hosts.")])]),e._v(" "),t("h3",{attrs:{id:"manager-nodes-for-fault-tolerance-link"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manager-nodes-for-fault-tolerance-link"}},[e._v("#")]),e._v(" Manager nodes for fault tolerance "),t("a",{attrs:{href:"https://docs.docker.com/engine/swarm/admin_guide/",target:"_blank",rel:"noopener noreferrer"}},[e._v("link"),t("OutboundLink")],1)]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Swarm Size")]),e._v(" "),t("th",[e._v("Majority")]),e._v(" "),t("th",[e._v("Fault Tolerance")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("1")]),e._v(" "),t("td",[e._v("1")]),e._v(" "),t("td",[e._v("0")])]),e._v(" "),t("tr",[t("td",[e._v("2")]),e._v(" "),t("td",[e._v("2")]),e._v(" "),t("td",[e._v("0")])]),e._v(" "),t("tr",[t("td",[e._v("3")]),e._v(" "),t("td",[e._v("2")]),e._v(" "),t("td",[e._v("1")])]),e._v(" "),t("tr",[t("td",[e._v("4")]),e._v(" "),t("td",[e._v("3")]),e._v(" "),t("td",[e._v("1")])]),e._v(" "),t("tr",[t("td",[e._v("5")]),e._v(" "),t("td",[e._v("3")]),e._v(" "),t("td",[e._v("2")])]),e._v(" "),t("tr",[t("td",[e._v("6")]),e._v(" "),t("td",[e._v("4")]),e._v(" "),t("td",[e._v("2")])]),e._v(" "),t("tr",[t("td",[e._v("7")]),e._v(" "),t("td",[e._v("4")]),e._v(" "),t("td",[e._v("3")])]),e._v(" "),t("tr",[t("td",[e._v("8")]),e._v(" "),t("td",[e._v("5")]),e._v(" "),t("td",[e._v("3")])]),e._v(" "),t("tr",[t("td",[e._v("9")]),e._v(" "),t("td",[e._v("5")]),e._v(" "),t("td",[e._v("4")])])])]),e._v(" "),t("h2",{attrs:{id:"creates-swarm-cluster-nodes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#creates-swarm-cluster-nodes"}},[e._v("#")]),e._v(" Creates Swarm Cluster Nodes")]),e._v(" "),t("p",[e._v("In this example, we decided to create two nodes (VM) for Swarm Cluster.")]),e._v(" "),t("ul",[t("li",[e._v("hostname: swarm-1 for "),t("strong",[e._v("MANAGER")]),e._v(" and being "),t("strong",[e._v("Leader")])]),e._v(" "),t("li",[e._v("hostname: swarm-2 for "),t("strong",[e._v("WORKER")])])]),e._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),t("p",[e._v("Please make sure that the following ports are available")]),e._v(" "),t("p",[e._v("TCP port 2377 for cluster management communications")]),e._v(" "),t("p",[e._v("TCP and UDP port 7946 for communication among nodes")]),e._v(" "),t("p",[e._v("UDP port 4789 for overlay network traffic")])]),e._v(" "),t("p",[e._v("swarm-1")]),e._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" swarm-1\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("docker swarm init --advertise-addr xxx.xxx.xxx.xxx\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("xxx.xxx.xxx.xxx is IP address of swarm-1 machine.")])]),e._v(" "),t("p",[e._v("output")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[e._v(" ")]),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Swarm initialized: current node (xxxxxxxxxxxxx) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token {token} xxx.xxx.xxx.xxx:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("p",[e._v("swarm-2")]),e._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" swarm-2\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker swarm join --token {token} xxx.xxx.xxx.xxx:2377\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"workshop"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#workshop"}},[e._v("#")]),e._v(" Workshop")]),e._v(" "),t("h3",{attrs:{id:"counter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#counter"}},[e._v("#")]),e._v(" "),t("RouterLink",{attrs:{to:"/lab08/deploy.html"}},[e._v("Counter")])],1)])}),[],!1,null,null,null);r.default=s.exports}}]);